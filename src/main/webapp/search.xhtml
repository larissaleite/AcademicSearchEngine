<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="templates/basic-template.xhtml">

	<ui:define name="content">

		<h:form id="searchForm" prependId="false">

			<div class="search">

				<div class="row">
					<div class="col-md-4"></div>
					<div class="col-md-4">

						<h4>Search</h4>

						<h:inputText value="#{searchBean.query}" styleClass="form-control"
							id="query" type="text" name="query" maxlength="100"
							placeholder="Search query" />

						<hr />

						<h:commandButton value="Search"
							styleClass="form-control btn btn-default">
							<f:ajax execute="@form" listener="#{searchBean.search}"
								render="@form" />
						</h:commandButton>
					</div>

					<div class="col-md-4"></div>
				</div>

				<div class="row">
					<div class="col-md-1"></div>
					<div class="col-md-8">
						<h:panelGroup id="searchResults" styleClass="results">
							<h:panelGroup rendered="#{not empty searchBean.items}">

								<p:dataTable tableStyleClass="resultsTable table table-striped"
									var="item" value="#{searchBean.items}">
									<p:column headerText="Id">
										<h:outputText value="#{item.id}" />
									</p:column>

									<p:column headerText="Title">
										<h:outputText value="#{item.title}" />
									</p:column>

									<p:column headerText="Author">
										<ui:repeat var="author" value="#{item.authors}">
											<h:outputText value="#{author}"
												styleClass="#{item.authorPreferred ? 'highlight-author' : 'author'}" />
										</ui:repeat>
									</p:column>

									<p:column headerText="Score">
										<h:outputText value="#{item.score}" />
									</p:column>

									<p:column headerText="">
										<p:commandButton styleClass="btn btn-info" value="Download"
											 >
											<p:ajax listener="#{searchBean.saveInteraction(item.id)}"
											oncomplete="$('#dlg').modal('show'); "
												update=":modalForm:dlgContent" />
										</p:commandButton>

									</p:column>
								</p:dataTable>

							</h:panelGroup>
						</h:panelGroup>

					</div>

					<div class="col-md-3 keywordRecommendation">
						<h:panelGroup id="clusterRecommendations" styleClass="results">
							<h:panelGroup
								rendered="#{not empty searchBean.clusterRecommendations and not empty searchBean.items}">
								<p style="font-weight: bold;">You might also be interested
									in:</p>
								<div class="keywords">
									<ui:repeat value="#{searchBean.clusterRecommendations}"
										var="keyword">
										<p class="keyword">#{keyword}</p>
									</ui:repeat>
								</div>

							</h:panelGroup>
						</h:panelGroup>
					</div>
				</div>
			</div>



		</h:form>

		<h:form id="modalForm">
			<h:panelGroup id="dlgContent">
				<div class="modal fade" id="dlg" role="dialog">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal"
									aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
								<h4 class="modal-title">Similar Items</h4>
							</div>
							<div class="modal-body">
								<ui:repeat value="#{searchBean.similarItems}" var="item">
									<p>#{item}</p>
								</ui:repeat>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default"
									data-dismiss="modal">Close</button>
							</div>
						</div>
					</div>
				</div>
			</h:panelGroup>
		</h:form>
	</ui:define>
</ui:composition>

</html>